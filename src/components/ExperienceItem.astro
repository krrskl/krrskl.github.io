---
import type { Experience } from "../utils/profile";

interface Props {
	experience: Experience;
}

const { experience } = Astro.props;

const formatDate = (dateString: string) => {
	if (dateString === "current") {
		return "Actualidad";
	}
	const date = new Date(dateString);
	return date.toLocaleDateString("es-ES", { year: "numeric", month: "short" });
};

const isCurrent = experience.endDate === "current";
---

<article class:list={["experience-item", { "is-current": isCurrent }]}>
	<div class="timeline-marker">
		<div class="marker-dot"></div>
		<div class="marker-line"></div>
	</div>

	<div class="experience-card">
		<div class="experience-header">
			<div class="experience-dates">
				<span class="date-badge">
					{formatDate(experience.startDate)} — {formatDate(experience.endDate)}
				</span>
				{isCurrent && <span class="current-badge">Actual</span>}
			</div>
			<h3 class="experience-title">{experience.jobTitle}</h3>
			<div class="experience-company">
				<span class="company-name">{experience.company}</span>
				<span class="separator">•</span>
				<span class="company-location">{experience.location}</span>
			</div>
		</div>

		<div class="experience-technologies">
			{experience.technologiesUsed.slice(0, 6).map((tech) => (
				<span class="tech-badge">{tech}</span>
			))}
			{experience.technologiesUsed.length > 6 && (
				<span class="tech-badge tech-more">+{experience.technologiesUsed.length - 6}</span>
			)}
		</div>
	</div>
</article>

<style>
.experience-item {
	display: flex;
	gap: 1.25rem;
	position: relative;
}

.timeline-marker {
	display: flex;
	flex-direction: column;
	align-items: center;
	flex-shrink: 0;
	width: 20px;
}

.marker-dot {
	width: 12px;
	height: 12px;
	border-radius: 50%;
	background: var(--border-color, rgba(255, 255, 255, 0.2));
	border: 2px solid var(--secondary-color, #1a1a2e);
	z-index: 1;
	flex-shrink: 0;
}

.is-current .marker-dot {
	background: var(--green-color, #4daa57);
	box-shadow: 0 0 0 4px rgba(77, 170, 87, 0.2);
}

.marker-line {
	width: 2px;
	flex: 1;
	background: var(--border-color, rgba(255, 255, 255, 0.1));
	margin-top: 0.5rem;
}

.experience-card {
	flex: 1;
	background: var(--card-bg, rgba(255, 255, 255, 0.03));
	border: 1px solid var(--border-color, rgba(255, 255, 255, 0.08));
	border-radius: 12px;
	padding: 1.25rem;
	margin-bottom: 1rem;
	transition: border-color 0.2s ease, transform 0.2s ease;
}

.experience-card:hover {
	border-color: rgba(255, 255, 255, 0.15);
	transform: translateX(4px);
}

.is-current .experience-card {
	border-color: rgba(77, 170, 87, 0.3);
	background: rgba(77, 170, 87, 0.05);
}

.experience-header {
	margin-bottom: 1rem;
}

.experience-dates {
	display: flex;
	align-items: center;
	gap: 0.5rem;
	margin-bottom: 0.5rem;
}

.date-badge {
	font-size: 0.75rem;
	color: var(--text-secondary, rgba(255, 255, 255, 0.5));
}

.current-badge {
	font-size: 0.65rem;
	padding: 0.15rem 0.5rem;
	background: rgba(77, 170, 87, 0.2);
	color: var(--green-color, #4daa57);
	border-radius: 9999px;
	font-weight: 500;
}

.experience-title {
	font-size: 1.1rem;
	font-weight: 600;
	color: var(--text-primary, #fff);
	margin: 0 0 0.35rem 0;
	line-height: 1.3;
}

.experience-company {
	display: flex;
	align-items: center;
	gap: 0.5rem;
	flex-wrap: wrap;
}

.company-name {
	font-size: 0.9rem;
	color: var(--text-secondary, rgba(255, 255, 255, 0.7));
	font-weight: 500;
}

.separator {
	color: var(--text-secondary, rgba(255, 255, 255, 0.3));
	font-size: 0.75rem;
}

.company-location {
	font-size: 0.8rem;
	color: var(--text-secondary, rgba(255, 255, 255, 0.5));
}

.experience-technologies {
	display: flex;
	flex-wrap: wrap;
	gap: 0.4rem;
}

.tech-badge {
	font-size: 0.7rem;
	padding: 0.2rem 0.5rem;
	background: var(--badge-bg, rgba(99, 102, 241, 0.15));
	color: var(--badge-color, #a5b4fc);
	border-radius: 9999px;
	white-space: nowrap;
}

.tech-more {
	background: rgba(255, 255, 255, 0.08);
	color: var(--text-secondary, rgba(255, 255, 255, 0.5));
}

@media (max-width: 640px) {
	.experience-item {
		gap: 1rem;
	}

	.timeline-marker {
		width: 16px;
	}

	.marker-dot {
		width: 10px;
		height: 10px;
	}

	.experience-card {
		padding: 1rem;
	}

	.experience-title {
		font-size: 1rem;
	}

	.company-name {
		font-size: 0.85rem;
	}
}
</style>
